############################################
# Genel temel ayarlar
############################################

# Apache rewrite motorunu aç
<IfModule mod_rewrite.c>
    RewriteEngine On

    # HTTPS'e zorla (SSL sertifikan varsa aç, yoksa bu bloğu yorum satırı yap)
    RewriteCond %{HTTPS} !=on
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# Klasör içeriğini listelemeyi kapat
Options -Indexes

# .htaccess dosyasını koru
<Files ".htaccess">
    Require all denied
</Files>

############################################
# Hassas dosyaları koru (.env, composer vs.)
############################################

# .env kesinlikle dışarı çıkmasın
<Files ".env">
    Require all denied
</Files>

# Bazı tipik proje dosyalarını engelle (varsa)
<FilesMatch "^(composer\.(json|lock)|phpunit\.xml|phpunit\.xml\.dist|\.gitignore)$">
    Require all denied
</FilesMatch>

# PHPMailer ve vendor klasörlerine doğrudan http erişimi kapat
# iletisim.php içerden require edebilir, sorun yok
<IfModule mod_rewrite.c>
    RewriteRule ^PHPMailer/ - [F,L]
    RewriteRule ^vendor/ - [F,L]
</IfModule>

############################################
# Güvenlik başlıkları (HTTP Security Headers)
############################################

<IfModule mod_headers.c>
    # Clickjacking'e karşı koruma
    Header always set X-Frame-Options "SAMEORIGIN"

    # MIME type sniffing kapat
    Header always set X-Content-Type-Options "nosniff"

    # Basit XSS koruması (eski ama zararsız)
    Header always set X-XSS-Protection "1; mode=block"

    # Referrer kontrolü
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Tarayıcı izinleri (kameraya vs. gerek yok burada)
    Header always set Permissions-Policy "geolocation=(), camera=(), microphone=()"

    # Sadece HTTPS için HSTS (HTTP'de 500 vermesin diye env=HTTPS)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS
</IfModule>

# Content-Security-Policy (CSP) istersen kullan ama inline CSS/JS'lerin var, kırabilir.
# Bu nedenle örnek bırakıyorum, önce test et:
#
# <IfModule mod_headers.c>
#     Header always set Content-Security-Policy "default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';"
# </IfModule>


############################################
# Gzip / Brotli sıkıştırma (sayfa boyutunu küçültür)
############################################

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml image/svg+xml
</IfModule>

# Bazı sunucularda Brotli de olabilir (varsa açmak istersen)
# <IfModule mod_brotli.c>
#     BrotliCompressionQuality 5
#     AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml image/svg+xml
# </IfModule>


############################################
# Tarayıcı cache ayarları (statik dosyaları önbellekle)
############################################

<IfModule mod_expires.c>
    ExpiresActive On

    # Resimler - 1 ay
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/png  "access plus 1 month"
    ExpiresByType image/gif  "access plus 1 month"
    ExpiresByType image/webp "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"

    # CSS ve JS - 1 ay
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"

    # Fontlar - 1 yıl
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"

    # HTML - kısa süre
    ExpiresByType text/html "access plus 10 minutes"
</IfModule>

<IfModule mod_headers.c>
    # Cache-Control başlıkları (özellikle statik dosyalar için)
    <FilesMatch "\.(js|css|png|jpg|jpeg|gif|svg|webp|ico|woff|woff2|ttf|otf)$">
        Header set Cache-Control "public, max-age=2592000"   # 30 gün
    </FilesMatch>
</IfModule>


############################################
# Hata sayfaları (istersen özelleştirebilirsin)
############################################

# Custom error pages kullanacaksan:
# ErrorDocument 404 /404.html
# ErrorDocument 500 /500.html
# ErrorDocument 403 /403.html
